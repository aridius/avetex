{{ header }} 
{{ column_left }} 
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <button type="submit" form="form-custom" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
		</div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if (error_warning) %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if (success is defined) %}
    <div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-custom" class="form-horizontal">
					<ul class="nav nav-tabs">
						<li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
						<li><a href="#tab-customer" data-toggle="tab">{{ tab_customer }}</a></li>
						<li><a href="#tab-shipping" data-toggle="tab">{{ tab_shipping }}</a></li>
						<li><a href="#tab-payment" data-toggle="tab">{{ tab_payment }}</a></li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane active" id="tab-general">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-country">{{ entry_country }}</label>
                <div class="col-sm-10">
                  <select name="module_custom_country_id" id="input-country" class="form-control">
                    {% for country in countries %}
                    {% if country.country_id == module_custom_country_id %}
                    <option value="{{ country.country_id }}" selected="selected">{{ country.name }}</option>
                    {% else %}
                    <option value="{{ country.country_id }}">{{ country.name }}</option>
                    {% endif %}
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-zone">{{ entry_zone }}</label>
                <div class="col-sm-10">
                  <select name="module_custom_zone_id" id="input-zone" class="form-control">
                  </select>
                </div>
              </div>
           <div class="form-group">
            <label class="col-sm-2 control-label" for="input-showcountry-status">{{ entry_showcountry }}</label>
            <div class="col-sm-10">
              <select name="module_custom_showcountry" id="input-showcountry-status" class="form-control">
               {% if module_custom_showcountry %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>	
<div class="form-group">
            <label class="col-sm-2 control-label" for="input-checkout_id-status">{{ entry_checkout_id }}</label>
            <div class="col-sm-10">
              <select name="module_custom_checkout_id" id="input-checkout_id-status" class="form-control">
               {% if module_custom_checkout_id %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
					 <div class="form-group">
            <label class="col-sm-2 control-label" for="input-login-status">{{ entry_login }}</label>
            <div class="col-sm-10">
              <select name="module_custom_loginr" id="input-login-status" class="form-control">
               {% if module_custom_loginr %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
              <div class="form-group">
               <label class="col-sm-2 control-label">{{ entry_mask }}</label>
               <div class="col-sm-10 them">
                 {% for language in languages %}
                 <div class="input-group">
                  <span class="input-group-addon">
                  <img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" />
                  </span>
                  <input name="module_custom_mask[{{ language.language_id }}]"
                    value="{{ module_custom_mask[language.language_id] }}"
                    class="form-control"/>
                 </div>
                 {% endfor %}
               </div>
              </div>					 
           <div class="form-group"> 
            <label class="col-sm-2 control-label" for="input-login-status">{{ entry_custom_login }}</label>
            <div class="col-sm-10">
              <select name="module_custom_login[status]" id="input-login-status" class="form-control">
               {% if module_custom_login.status %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
           <div class="form-group" style="display:none;">
            <label class="col-sm-2 control-label" for="input-cart-status">{{ entry_cart }}</label>
            <div class="col-sm-10">
              <select name="module_custom_cart[status]" id="input-cart-status" class="form-control">
               {% if module_custom_cart.status %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="1">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="1" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
           <div class="form-group">
            <label class="col-sm-2 control-label" for="input-comment-status">{{ entry_comment }}</label>
            <div class="col-sm-10">
              <select name="module_custom_comment[status]" id="input-comment-status" class="form-control">
               {% if module_custom_comment.status %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
           <div class="form-group">
            <label class="col-sm-2 control-label" for="input-module-status">{{ entry_module }}</label>
            <div class="col-sm-10">
              <select name="module_custom_module[status]" id="input-module-status" class="form-control">
               {% if module_custom_module.status %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>
           <div class="form-group">
            <label class="col-sm-2 control-label" for="input-total-status">{{ entry_total }}</label>
            <div class="col-sm-10">
              <select name="module_custom_total[status]" id="input-total-status" class="form-control">
               {% if module_custom_total.status %}
               <option value="1" selected="selected">{{ text_yes }}</option>
               <option value="0">{{ text_no }}</option>
{% else %} 
               <option value="1">{{ text_yes }}</option>
               <option value="0" selected="selected">{{ text_no }}</option>
               {% endif %}
              </select>
            </div>
           </div>		   
							<div class="form-group">
								<label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
								<div class="col-sm-10">
									<select name="module_custom_status" id="input-status" class="form-control">
										{% if (module_custom_status) %} 
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
										{% else %} 
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
										{% endif %} 
									</select>
								</div>
							</div>
						</div>
						<div class="tab-pane" id="tab-customer">
							<input type="hidden" name="module_custom_customer[status]" value="1">
							<table id="customer-field" class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<td class="text-left">
										{{ column_field }} 
									</td>
									<td>
										{{ column_custumer_group }} 
									</td>
									<td>
										{{ column_required }} 
									</td>
									<td>
										{{ column_validation }} 
									</td>
									<td width="56px"></td>
								</tr>
							</thead>
							<tbody>
								{% set customer_key = 0 %}
								{% if module_custom_customer.fields %}
								{% for field in module_custom_customer.fields %}
									<tr id="customer-field-{{ customer_key }}">
										<td>
											<select name="module_custom_customer[fields][{{ customer_key }}][name]" id="input-customer-fields-{{ customer_key }}" class="form-control">
												{% for name, item in module_custom_customer.list %}
													{% set selected = '' %}
													{% if field.name == name %}
														{% set selected = 'selected="selected"' %}
													{% endif %}
													<option value="{{ name }}" {{ selected }}>{{ item.label }}</option>
												{% endfor %}
											</select>
										</td>
										<td>
											{% set customer_group_row = 0 %}
											{% for customer_group in customer_groups %}
												<div class="checkbox"><label>
													{% if field.customer_group and (customer_group.customer_group_id in field.customer_group) %}
														<input type="checkbox" name="module_custom_customer[fields][{{ customer_key }}][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" checked="checked" />
													{% else %}
														<input type="checkbox" name="module_custom_customer[fields][{{ customer_key }}][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />
													{% endif %}
													{{ customer_group.name }}
												</label></div>
												{% set customer_group_row = customer_group_row + 1 %}
											{% endfor %}
										</td>
										<td>
											{% set customer_group_row = 0 %}
											{% for customer_group in customer_groups %}
												<div class="checkbox"><label>
													{% if field.required and (customer_group.customer_group_id in field.required) %}
														<input type="checkbox" name="module_custom_customer[fields][{{ customer_key }}][required][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" checked="checked" />
													{% else %}
														<input type="checkbox" name="module_custom_customer[fields][{{ customer_key }}][required][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />
													{% endif %}
													{{ customer_group.name }}
												</label></div>
												{% set customer_group_row = customer_group_row + 1 %}
											{% endfor %}
										</td>
										<td>
											<input type="text" name="module_custom_customer[fields][{{ customer_key }}][validation]" value="{{ field.validation }}" placeholder="{{ entry_validate }}" id="input-customer-sort" class="form-control"/>
										</td>
										<td>
											<button type="button" onclick="jQuery('#customer-field-{{ customer_key }}').remove()" data-toggle="tooltip" title="{{ entry_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
										</td>
									</tr>
									{% set customer_key = customer_key + 1 %}
								{% endfor %}
								{% endif %}
							</tbody>
							<tfoot>
								<td colspan="4"></td>
								<td>
									<button type="button" onclick="addcustomerField()" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="Добавить поле"><i class="fa fa-plus-circle"></i></button>
								</td>
							</tfoot>
							</table>
							<script>
								var customerField = {{ customer_key }};
								function addcustomerField(){
									html  = '<tr id="customer-field-' + customerField + '">';
										html += '<td><select name="module_custom_customer[fields][' + customerField + '][name]" id="input-customer-fields-' + customerField + '" class="form-control">';
										{% for name, item in module_custom_customer.list %}
											html += "<option value='{{ name }}' >{{ item.label }}";
										{% endfor %}
									html += '</select></td>';
									html += '<td>';
										{% set customer_group_row = 0 %}
										{% for customer_group in customer_groups %}
											html += '<div class="checkbox"><label><input type="checkbox" name="module_custom_customer[fields][' + customerField + '][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />{{ customer_group.name }}</label></div>';
											{% set customer_group_row = customer_group_row + 1 %}
										{% endfor %}
									html += '</td>';
									html += '<td>';
										{% set customer_group_row = 0 %}
										{% for customer_group in customer_groups %}
											html += '<div class="checkbox"><label><input type="checkbox" name="module_custom_customer[fields][' + customerField + '][required][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />{{ customer_group.name }}</label></div>';
											{% set customer_group_row = customer_group_row + 1 %}
										{% endfor %}
									html += '</td>';
									html += '<td><input type="text" name="module_custom_customer[fields][' + customerField + '][validation]" placeholder="{{ entry_validate}}" id="input-customer-sort" class="form-control"/></td>';
									html += '<td><button type="button" onclick="jQuery(\'#customer-field-' + customerField + '\').remove();" data-toggle="tooltip" title="Удалить" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
									html += '</tr>';
									jQuery('#customer-field').append(html);
									customerField++;
								};
							</script>
						</div>
						<div class="tab-pane" id="tab-shipping">
							 <div class="form-group" style="display: none;">
								<label class="col-sm-2 control-label" for="input-shipping-status">{{ entry_view }}</label>
								<div class="col-sm-10">
									<select name="module_custom_shipping[status]" id="input-shipping-status" class="form-control">
										{% if module_custom_shipping.status %}
										<option value="1" selected="selected">{{ text_yes }}</option>
										<option value="0">{{ text_no }}</option>
										{% else %}
										<option value="1">{{ text_yes }}</option>
										<option value="0" selected="selected">{{ text_no }}</option>
										{% endif %}
									</select>
								</div>
							</div>
							<br>
							<table id="shipping-field" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<td class="text-left">{{ column_field }}</td>
										<td>{{ column_shipping_method }}</td>
										<td>{{ column_required }}</td>
										<td>{{ column_validation }}</td>
										<td width="56px"></td>
									</tr>
								</thead>
								<tbody>
									{% set shipping_key = 0 %}
									{% if module_custom_shipping.fields %}
									{% for field in module_custom_shipping.fields %}
										<tr id="shipping-field-{{ shipping_key }}">
											<td>
												<select name="module_custom_shipping[fields][{{ shipping_key }}][name]" id="input-shipping-fields-{{ shipping_key }}" class="form-control">
													{% for name, item in module_custom_shipping.list %}
														{% set selected = '' %}
														{% if field.name == name %}
															{% set selected = 'selected="selected"' %}
														{% else %}
															{% set selected = 'data-field-name="' + field.name + '"' %}
														{% endif %}
														<option value="{{ name }}" {{ selected }} >{{ item.label }}</option>
													{% endfor %}
												</select>
											</td>
											<td>
												{% set method_row = 0 %}
												{% for method in module_custom_shipping.methods %}
												<div class="checkbox"><label>
													{% if field.method and (method.code in field.method) %}
														<input type="checkbox" name="module_custom_shipping[fields][{{ shipping_key }}][method][{{ method_row }}]" value="{{ method.code }}" checked="checked" />
													{% else %}
														<input type="checkbox" name="module_custom_shipping[fields][{{ shipping_key }}][method][{{ method_row }}]" value="{{ method.code }}" />
													{% endif %}
													{{ method.label }}
												</label></div>
												{% set method_row = method_row + 1 %}
												{% endfor %}
											</td>
											</td>
											<td>
												{% set method_row = 0 %}
												{% for method in module_custom_shipping.methods %}
												<div class="checkbox"><label>
													{% if field.required and (method.code in field.required) %}
														<input type="checkbox" name="module_custom_shipping[fields][{{ shipping_key }}][required][{{ method_row }}]" value="{{ method.code }}" checked="checked" />
													{% else %}
														<input type="checkbox" name="module_custom_shipping[fields][{{ shipping_key }}][required][{{ method_row }}]" value="{{ method.code }}" />
													{% endif %}
													{{ method.label }}
												</label></div>
												{% set method_row = method_row + 1 %}
												{% endfor %}
											</td>
											<td>
												<input type="text" name="module_custom_shipping[fields][{{ shipping_key }}][validation]" value="{{ field.validation }}" placeholder="{{ entry_validate }}" id="input-shipping-sort" class="form-control"/>
											</td>
											<td>
												<button type="button" onclick="jQuery('#shipping-field-{{ shipping_key }}').remove()" data-toggle="tooltip" title="{{ entry_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
											</td>
										</tr>
										{% set shipping_key = shipping_key + 1 %}
									{% endfor %}
									{% endif %}
								</tbody>
								<tfoot>
									<td colspan="4"></td>
									<td>
										<button type="button" onclick="addShippingField()" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="Добавить поле"><i class="fa fa-plus-circle"></i></button>
									</td>
								</tfoot>
							</table>
							<script>
								var shippingField = {{ shipping_key }};
								function addShippingField(){
									html  = '<tr id="shipping-field-' + shippingField + '">';
									html += '<td><select name="module_custom_shipping[fields][' + shippingField + '][name]" id="input-shipping-fields-' + shippingField + '" class="form-control">';
										{% for name, item in module_custom_shipping.list %}
											html += '<option value="{{ name }}" >{{ item.label }}';
										{% endfor %}
									html += '</select></td>';
									html += '<td>';
										{% set method_row = 0 %}
										{% for method in module_custom_shipping.methods %}
											html += "<div class='checkbox'><label><input type='checkbox' name='module_custom_shipping[fields][' + shippingField + '][method][{{ method_row }}]' value='{{ method.code }}' />{{ method.label }}</label></div>";
											{% set method_row = method_row + 1 %}
										{% endfor %}
									html += '</td>';
									html += '<td>';
										{% set method_row = 0 %}
										{% for method in module_custom_shipping.methods %}
											html += "<div class='checkbox'><label><input type='checkbox' name='module_custom_shipping[fields][' + shippingField + '][required][{{ method_row }}]' value='{{ method.code }}' />{{ method.label }}</label></div>";
											{% set method_row = method_row + 1 %}
										{% endfor %}
									html += '</td>';
									html += '<td><input type="text" name="module_custom_shipping[fields][' + shippingField + '][validation]" value="{{ field.validation }}" placeholder="{{ entry_validate }}" id="input-shipping-sort" class="form-control"/></td>';
									html += '<td><button type="button" onclick="jQuery(\'#shipping-field-' + shippingField + '\').remove();" data-toggle="tooltip" title="Удалить" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
									html += '</tr>';
									jQuery('#shipping-field').append(html);
									shippingField++;
								};
							</script>
						</div>
						<div class="tab-pane" id="tab-payment">
							<input type="hidden" name="module_custom_payment[status]" value="1">
							<table id="payment-methods" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<td class="text-left">{{ column_field }}</td>
										<td >{{ column_custumer_group }}</td>
										<td width="56px"></td>
									</tr>
								</thead>
								<tbody>
									{% set payment_key = 0 %}
									{% if module_custom_payment.methods %}
									{% for method in module_custom_payment.methods %}
										<tr id="payment-method-{{ payment_key }}">
											<td>
												<select name="module_custom_payment[methods][{{ payment_key }}][name]" id="input-customer-method-{{ payment_key }}" class="form-control">
													{% for item in module_custom_payment.list %}
														{% set selected = '' %}
														{% if item.code == method.name %}
															{% set selected = 'selected="selected"' %}
														{% endif %}
														<option value="{{ item.code }}" {{ selected }}>{{ item.label }}</option>
													{% endfor %}
												</select>
											</td>
											<td>
												{% set customer_group_row = 0 %}
												{% for customer_group in customer_groups %}
													<div class="checkbox"><label>
														{% if method.customer_group and (customer_group.customer_group_id in method.customer_group) %}
															<input type="checkbox" name="module_custom_payment[methods][{{ payment_key }}][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" checked="checked" />
														{% else %}
															<input type="checkbox" name="module_custom_payment[methods][{{ payment_key }}][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />
														{% endif %}
														{{ customer_group.name }}
													</label></div>
												{% set customer_group_row = customer_group_row + 1 %}
												{% endfor %}
											</td>
											<td>
												<button type="button" onclick="jQuery('#payment-method-{{ payment_key }}').remove()" data-toggle="tooltip" title="{{ entry_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button>
											</td>
										</tr>
										{% set payment_key = payment_key + 1 %}
									{% endfor %}
									{% endif %}
								</tbody>
								<tfoot>
									<td colspan="2"></td>
									<td>
										<button type="button" onclick="addPaymentMethod()" data-toggle="tooltip" title="" class="btn btn-primary" data-original-title="Добавить поле"><i class="fa fa-plus-circle"></i></button>
									</td>
								</tfoot>
							</table>
							<script>
							var payment_key = {{ payment_key }};
							function addPaymentMethod(){
								html  = '<tr id="payment-method-' + payment_key + '">';
								html += '<td><select name="module_custom_payment[methods][' + payment_key + '][name]" id="input-payment-method-' + payment_key + '" class="form-control">';
									{% for name, item in module_custom_payment.list %}
										html += '<option value="{{ item.code }}" >{{ item.label }}';
									{% endfor %}
								html += '</select></td>';
								html += '<td>';
									{% set customer_group_row = 0 %}
									{% for customer_group in customer_groups %}
										html += '<div class="checkbox"><label><input type="checkbox" name="module_custom_payment[methods][' + payment_key + '][customer_group][{{ customer_group_row }}]" value="{{ customer_group.customer_group_id }}" />{{ customer_group.name }}</label></div>';
										{% set customer_group_row = customer_group_row + 1 %}
									{% endfor %}
								html += '</td>';
								html += '<td><button type="button" onclick="jQuery(\'#payment-method-' + payment_key + '\').remove();" data-toggle="tooltip" title="Удалить" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
								html += '</tr>';
								jQuery('#payment-methods').append(html);
								payment_key++;
							};
							</script>
						</div>
					</div>
				</form>
			</div>
    </div>
  </div>
</div>
  <script>
$('select[name=\'module_custom_country_id\']').on('change', function() {
	$.ajax({
		url: 'index.php?route=localisation/country/country&user_token={{ user_token }}&country_id=' + this.value,
		dataType: 'json',
		beforeSend: function() {
			$('select[name=\'module_custom_country_id\']').prop('disabled', true);
		},
		complete: function() {
			$('select[name=\'module_custom_country_id\']').prop('disabled', false);
		},
		success: function(json) {
			html = '<option value="">{{ text_select }}</option>';

			if (json['zone'] && json['zone'] != '') {
				for (i = 0; i < json['zone'].length; i++) {
          			html += '<option value="' + json['zone'][i]['zone_id'] + '"';

					if (json['zone'][i]['zone_id'] == '{{ module_custom_zone_id }}') {
            			html += ' selected="selected"';
					}

					html += '>' + json['zone'][i]['name'] + '</option>';
				}
			} else {
				html += '<option value="0" selected="selected">{{ text_none }}</option>';
			}

			$('select[name=\'module_custom_zone_id\']').html(html);
			
			$('#button-save').prop('disabled', false);
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});

$('select[name=\'module_custom_country_id\']').trigger('change');
</script>
{{ footer }}